<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
	<title>De Jonge</title>
	<!-- JQuery -->
    <link rel="stylesheet" href="jquery/css/ui-lightness/jquery-ui-1.10.3.custom.css" />
    <script type="text/javascript" src="jquery/js/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="jquery/js/jquery-ui-1.10.3.custom.min.js"></script>

	<script type="text/javascript" src="log4javascript.js"></script>

	<!-- Sammy -->
 	<script type='text/javascript' src="sammy.js"></script>
 	
 	<!-- Moments -->
 	<script type='text/javascript' src="moment.js"></script>
 	
 	<!-- Knockout -->
 	<script type='text/javascript' src="knockout-2.2.1.js"></script>
 	
 	<script src="knockout.mapping.js" type="text/javascript"></script>
 	<script src="commons/3rdparty/knockoutValidation/knockout.validation.min.js" type="text/javascript"></script>
 	<script src="commons/3rdparty/knockoutValidation/nl-NL.js" type="text/javascript"></script>
 	
 	<!-- Require JS -->
 	<script src="commons/3rdparty/require.js" data-main="" type="text/javascript"></script>
 	<script>
			requirejs.config({
				path : {
					'ko' : 'commons/3rdparty/knockout',
					'ko.validation' : 'commons/3rdparty/knockoutValidaton/knockout.validation.min'
				},
				shim : {
					'log4javascript' : {
						exports : 'log4javascript',
						init : function() {
							log4javascript.setDocumentReady();
						},
						'ko.validation' : [ 'ko' ]
					},
					map : {
						'ko.validation' : {
							'knockout' : 'ko'
						}
					}
				}
			});
		</script>
    
    <!-- Twitter Bootstrap -->
	<link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
	<script src="bootstrap/js/bootstrap.min.js"></script>
	<script src="bootstrap/typeahead.js"></script>

	<!-- Eigen CSS -->
	<link rel="stylesheet" href="lakedigital.css">

	<script type="text/javascript">
 		$(window).load(function(){
 			var log = log4javascript.getLogger("LakeDigital");
 			var browserAppender = new log4javascript.BrowserConsoleAppender();
 		    var popUpLayout = new log4javascript.PatternLayout("%d{HH:mm:ss} %-5p - %m%n");
			browserAppender.setLayout(popUpLayout);
			log.addAppender(browserAppender);

  			haalIngelogdeGebruiker();
			window.setInterval(haalIngelogdeGebruiker, 300000);
			
			var _relatieId;
			var _subId;

			var diasRoute = new Sammy('body');

			diasRoute.route('GET', '#inloggen', function(context) {
 				$('#content').load('pages/inloggen/content.html', function(response, status, xhr) {
					if (status == "success") {
						start();
					}
				});
			});

			diasRoute.route('GET', '#lijstRelaties', function(context) {
 				$('#content').load('pages/lijstRelaties/content.html', function(response, status, xhr) {
					if (status == "success") {
						maakDatatable();
					}
				});
			});

			diasRoute.route('GET', '#beherenRelatie/:id/:actie/:subId', function(context) {
				id = this.params['id'];
				actie = this.params['actie'];
				subId = this.params['subId'];
				$.getScript("pages/beherenRelatie/beherenRelatie.js", function(){
					start(log, id, actie, subId);
				});
			});

			diasRoute.route('GET', '#beherenRelatie/:id/:actie', function(context) {
				id = this.params['id'];
				actie = this.params['actie'];
				$.getScript("pages/beherenRelatie/beherenRelatie.js", function(){
					start(log, id, actie);
				});
			});

			diasRoute.route('GET', '#beherenRelatie/:id', function(context) {
				id = this.params['id'];
				$.getScript("pages/beherenRelatie/beherenRelatie.js", function(){
					start(log, id);
				});
			});

			diasRoute.route('GET', '#beherenRelatie', function(context) {
				$.getScript("pages/beherenRelatie/beherenRelatie.js", function(){
					start(log, null);
				});
			});

			diasRoute.route('GET', '', function(context) {
 				$('#content').load('pages/lijstRelaties/content.html', function(response, status, xhr) {
					if (status == "success") {
						maakDatatable();
					}
				});
			});

			diasRoute.run();
		});

 		laadMenu = function() {
			$.ajax({
				type: "GET",
				url: './rest/authorisatie/authorisatie/isIngelogd',
				dataType:'json',
				success: function (data) {
					if(new String(data) == "true"){
						$('#menu').load('pages/menu/menuIngelogd.html');
					}else{
						$('#menu').load('pages/menu/menu.html');
					}
				}
			});
 		}
 		plaatsFoutmelding = function(melding){
        	var foutmelding = jQuery.parseJSON(melding.responseText);
        	
			$('#alertDanger').show();
			$('#alertDanger').html("Er is een fout opgetreden : " + foutmelding.foutmelding);
 		}
		var refreshIntervalId;
 		plaatsMelding = function(melding){
 			$("html, body").animate({ scrollTop: 0 }, "slow");
			$('#alertSucces').show();
			$('#alertSucces').html(melding);
			refreshIntervalId = setInterval(verbergMeldingen, 10000);
		}
 		verbergMeldingen = function(){
			clearInterval(refreshIntervalId); 		
 			$("html, body").animate({ scrollTop: 0 }, "slow");
			$('#alertSucces').hide();
			$('#alertDanger').hide();
 		}
		function uploadBestand(formData, url){
    	    $.ajax({
				url: url,
    	        type: 'POST',
    	        xhr: function() {  // Custom XMLHttpRequest
    	            var myXhr = $.ajaxSettings.xhr();
    	            if(myXhr.upload){ // Check if upload property exists
    	                myXhr.upload.addEventListener('progress',progressHandlingFunction, false); // For handling the progress of the upload
    	            }
    	            return myXhr;
    	        },
    	        data: formData,
    	        cache: false,
    	        contentType: false,
    	        processData: false,
	            success: function (response) {
	            	plaatsMelding("De gegevens zijn opgeslagen");
	            },
	            error: function (data) {
	            	plaatsFoutmelding(data);
	            }
    	    });
    	    function progressHandlingFunction(e){
    	        if(e.lengthComputable){
    	            $('progress').attr({value:e.loaded,max:e.total});
    	        }
    	    }
		}
		haalIngelogdeGebruiker = function(){
	    	$.ajax({
	            url: '../dejonge/rest/authorisatie/authorisatie/ingelogdeGebruiker',
	            type: 'GET',
	            contentType: 'application/json; charset=utf-8',
	            success: function (response) {
	            	if(response.kantoor != null){
						$('#ingelogdeGebruiker').html("Ingelogd als : " + response.gebruikersnaam + ", (" + response.kantoor + ")");
	            	}else{
						$('#ingelogdeGebruiker').html("Ingelogd als : " + response.gebruikersnaam);
	            	}
					$('#uitloggen').show();
					$('#homeKnop').show();
	            },
	            error: function (data) {
					$('#ingelogdeGebruiker').html("");
					$('#uitloggen').hide();
					$('#homeKnop').hide();
	    			document.location.hash='#inloggen';
	            }
	        });
		}
		uitloggen = function(){
	    	$.ajax({
	            url: '../dejonge/rest/authorisatie/authorisatie/uitloggen',
	            type: 'GET'
	    	})
			$('#ingelogdeGebruiker').html("");
			$('#uitloggen').hide();
			$('#homeKnop').hide();
			document.location.hash='#inloggen';
		}
		
	</script>
</head>
<body id="body">
	<img id="homeKnop" src="images/home.png" alt="Naar de lijst met Relaties" style="cursor:pointer; display:none;float:left;" onclick="document.location.hash='#lijstRelaties'" />
	<div id="ingelogdeGebruiker"></div>
	<div class="uitloggen" id="uitloggen" onclick="uitloggen();">Uitloggen</div>
	<div id="menu"></div>
	<div class="alert alert-success" style="display:none;" id="alertSucces"></div>
	<div class="alert alert-danger" style="display:none;" id="alertDanger"></div>
	<div id="content">DIAS</div>
</body>
</html>